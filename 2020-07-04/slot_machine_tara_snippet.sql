-- MySQL dump 10.13  Distrib 5.7.17, for macos10.12 (x86_64)
--
-- Host: tarabackend.cwiu9dmvcutz.us-east-1.rds.amazonaws.com    Database: slot_machine
-- ------------------------------------------------------
-- Server version	5.7.22-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `tara_snippet`
--

DROP TABLE IF EXISTS `tara_snippet`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `tara_snippet` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL DEFAULT '',
  `filter_id` varchar(25) DEFAULT NULL,
  `content` text,
  `content_html` text,
  `created_on` datetime DEFAULT NULL,
  `updated_on` datetime DEFAULT NULL,
  `created_by_id` int(11) DEFAULT NULL,
  `updated_by_id` int(11) DEFAULT NULL,
  `position` mediumint(6) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=MyISAM AUTO_INCREMENT=17 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `tara_snippet`
--

LOCK TABLES `tara_snippet` WRITE;
/*!40000 ALTER TABLE `tara_snippet` DISABLE KEYS */;
INSERT INTO `tara_snippet` VALUES (1,'layoutFunctions','','<?php\r\n/*+++++++++++++++++++++++++++++++++++++++Active menu layout+++++++++++++++++++++++++++++++++++++++++*/\r\n   function getAClass($slug, $page)\r\n    {\r\n        if($page->slug == $slug || ($page->slug!=\'\' && $page->parent!=null && $page->parent->slug==$slug && $page->parent->slug!=\'\') || ($page->slug!=\'\' && $page->parent->parent!=null && $page->parent->parent->slug==$slug && $page->parent->parent->slug!=\'\'))\r\n        {\r\n            echo(\"active\");\r\n        }\r\n        else\r\n        {\r\n            echo(\"\");\r\n        }\r\n    }\r\n    function getLiClass ($slug, $page )\r\n    {\r\n        if($page->slug == $slug || ($page->parent!=null && $page->parent->slug==$slug && $page->parent->slug!=\'\'))\r\n        {\r\n            echo(\"active\");\r\n        }\r\n        else\r\n        {\r\n            echo(\"\");\r\n        }\r\n\r\n    }\r\n/*+++++++++++++++++++++++++++++++++++++++@Active menu layout+++++++++++++++++++++++++++++++++++++++++*/\r\n\r\n/*+++++++++++++++++++++++++++++++++++++++Title+++++++++++++++++++++++++++++++++++++++++*/\r\nfunction getTitle($page)\r\n{\r\n    $title=\' | \';\r\n\r\n    if($page->parent && $page->parent->slug!=\'\')\r\n    {\r\n            $title.=$page->parent->title().\' - \';\r\n    }\r\n    $title.=$page->title();\r\n    echo($title);\r\n}\r\n/*+++++++++++++++++++++++++++++++++++++++@Title+++++++++++++++++++++++++++++++++++++++++*/\r\n?>\r\n','<?php\r\n/*+++++++++++++++++++++++++++++++++++++++Active menu layout+++++++++++++++++++++++++++++++++++++++++*/\r\n   function getAClass($slug, $page)\r\n    {\r\n        if($page->slug == $slug || ($page->slug!=\'\' && $page->parent!=null && $page->parent->slug==$slug && $page->parent->slug!=\'\') || ($page->slug!=\'\' && $page->parent->parent!=null && $page->parent->parent->slug==$slug && $page->parent->parent->slug!=\'\'))\r\n        {\r\n            echo(\"active\");\r\n        }\r\n        else\r\n        {\r\n            echo(\"\");\r\n        }\r\n    }\r\n    function getLiClass ($slug, $page )\r\n    {\r\n        if($page->slug == $slug || ($page->parent!=null && $page->parent->slug==$slug && $page->parent->slug!=\'\'))\r\n        {\r\n            echo(\"active\");\r\n        }\r\n        else\r\n        {\r\n            echo(\"\");\r\n        }\r\n\r\n    }\r\n/*+++++++++++++++++++++++++++++++++++++++@Active menu layout+++++++++++++++++++++++++++++++++++++++++*/\r\n\r\n/*+++++++++++++++++++++++++++++++++++++++Title+++++++++++++++++++++++++++++++++++++++++*/\r\nfunction getTitle($page)\r\n{\r\n    $title=\' | \';\r\n\r\n    if($page->parent && $page->parent->slug!=\'\')\r\n    {\r\n            $title.=$page->parent->title().\' - \';\r\n    }\r\n    $title.=$page->title();\r\n    echo($title);\r\n}\r\n/*+++++++++++++++++++++++++++++++++++++++@Title+++++++++++++++++++++++++++++++++++++++++*/\r\n?>\r\n','2014-03-17 18:00:32','2014-03-25 15:39:45',1,1,NULL),(9,'jsAppend','','<!-- ############################ TEMPLATE ################################## -->\r\n<script type=\"text/javascript\" src=\"<? echo(URL_PUBLIC); ?>public/js/template.js\"></script>\r\n<!-- ############################ END TEMPLATE ################################## -->\r\n\r\n<!-- ############################ GENERICO ################################## -->\r\n<? if($this!=null && $this->slug!=null && file_exists(SERVER_URL.\'/public/js/\'.$this->slug.\'.js\')): ?>\r\n    <script type=\"text/javascript\" src=\"<? echo(URL_PUBLIC); ?>public/js/<? echo($this->slug); ?>.js\"></script>\r\n<? endif; ?>\r\n<!-- ############################ END GENERICO ################################## -->','<!-- ############################ TEMPLATE ################################## -->\r\n<script type=\"text/javascript\" src=\"<? echo(URL_PUBLIC); ?>public/js/template.js\"></script>\r\n<!-- ############################ END TEMPLATE ################################## -->\r\n\r\n<!-- ############################ GENERICO ################################## -->\r\n<? if($this!=null && $this->slug!=null && file_exists(SERVER_URL.\'/public/js/\'.$this->slug.\'.js\')): ?>\r\n    <script type=\"text/javascript\" src=\"<? echo(URL_PUBLIC); ?>public/js/<? echo($this->slug); ?>.js\"></script>\r\n<? endif; ?>\r\n<!-- ############################ END GENERICO ################################## -->','2014-03-18 11:48:02','2014-05-21 16:10:28',1,1,NULL),(14,'service','','<?\r\n\r\nif (isset($_GET[\'opt\'])) {\r\n    $__tarambola_CONN__ = new PDO(DB_DSN, DB_USER, DB_PASS);\r\n\r\n    if ($__tarambola_CONN__->getAttribute(PDO::ATTR_DRIVER_NAME) == \'mysql\')\r\n        $__tarambola_CONN__->setAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY, true);\r\n\r\n    Record::connection($__tarambola_CONN__);\r\n    Record::getConnection()->exec(\"set names \'utf8\'\");\r\n\r\n    if ($_GET[\'opt\'] == \"win\") { //****************************************************** WIN SEND EMAIL\r\n        $user = getUser($_GET[\'id\']);\r\n        $nome = $user->content(\'nome\');\r\n        $email = $user->content(\'email\');\r\n        echo($nome . \' - \' . $email);\r\n        echo(updatePremio($_GET[\'id\'], $_GET[\'premio\']));\r\n        echo(sendEmail($nome, $email, $_GET[\'premio\']));\r\n        incrementPremio();\r\n    } else if ($_GET[\'opt\'] == \"loose\") { //************************************************ LOOSE\r\n    } else if ($_GET[\'opt\'] == \"getid\") { //************************************************ GET UNIQUE ID\r\n        require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n\r\n        $premios = getPremiosByDate();\r\n        if ($premios == null) {\r\n            insertPremios();\r\n            $premios = getPremiosByDate();\r\n        }\r\n        $config = getConfig();\r\n\r\n        $p = new Item();\r\n        $p = $p->getPageById(315);\r\n        echo(\'<?xml version=\"1.0\" encoding=\"UTF-8\"?>\' .\r\n            \'<data>\' .\r\n            \'<unique_id>\' . generateId() . \'</unique_id>\' .\r\n            \'<connect_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"connect_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"connect_2\") . \'</msg_2>\' .\r\n            \'<msg_3>\' . $p->content(\"connect_3\") . \'</msg_3>\' .\r\n            \'</connect_msg>\' .\r\n            \'<slot_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"slot_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"slot_2\") . \'</msg_2>\' .\r\n            \'</slot_msg>\' .\r\n            \'<loose_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"loose_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"loose_2\") . \'</msg_2>\' .\r\n            \'<msg_3>\' . $p->content(\"loose_3\") . \'</msg_3>\' .\r\n            \'<msg_4>\' . $p->content(\"loose_4\") . \'</msg_4>\' .\r\n            \'<msg_5>\' . $p->content(\"loose_5\") . \'</msg_5>\' .\r\n            \'</loose_msg>\' .\r\n            \'<win_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"win_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"win_2\") . \'</msg_2>\' .\r\n            \'</win_msg>\' .\r\n            \'<prizes>\' .\r\n            \'<act_prizes>\' . $premios->qtd . \'</act_prizes>\' .\r\n            \'<max_prize>\' . $config->content(\'nr_premios\') . \'</max_prize>\' .\r\n            \'<last_prize>\' . $premios->last . \'</last_prize>\' .\r\n            \'</prizes>\' .\r\n            \'</data>\'\r\n        );\r\n    }\r\n} else {\r\n    $config = getConfig();\r\n    $user = getUser($_GET[\'id\']);\r\n    $attempts = getAttempts($user->content(\'email\'));\r\n    $attempts = intval($config->content(\'max_attempts\')) - $attempts;\r\n    $premios = getPremiosByDate();\r\n    if ($premios == null) {\r\n        insertPremios();\r\n        $premios = getPremiosByDate();\r\n    }\r\n    echo(\'<?xml version=\"1.0\" encoding=\"UTF-8\"?>\' .\r\n        \'<user>\' .\r\n        \'<id>\' . $user->id . \'</id>\' .\r\n        \'<nome>\' . $user->content(\'nome\') . \'</nome>\' .\r\n        \'<email>\' . $user->content(\'email\') . \'</email>\' .\r\n        \'<unique_id>\' . $user->content(\'unique_id\') . \'</unique_id>\' .\r\n        \'<attempts>\' . $attempts . \'</attempts>\' .\r\n        \'<maxAttempts>\' . $config->content(\'max_attempts\') . \'</maxAttempts>\' .\r\n        \'</user>\');\r\n}\r\n\r\n//*************************** FUNCTIONS *********************************//\r\nfunction getUser($id)\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n    $p = new Item();\r\n    $p = $p->getPageById($id);\r\n    return ($p);\r\n}\r\n\r\nfunction getAttempts($email)\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"SELECT DISTINCT count(p.id) AS count From tara_page_part AS p INNER JOIN tara_page_part AS p2 ON p2.page_id=p.page_id WHERE p.name=\'data\' AND DAY(NOW())=DAY(p.content) AND MONTH(NOW())=MONTH(p.content) AND YEAR(NOW())=YEAR(p.content) AND p2.name=\'email\' AND p2.content=\'\" . $email . \"\'\";\r\n    $arr = array();\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        $stmt->execute();\r\n        $object = $stmt->fetchObject();\r\n    }\r\n    $config = getConfig();\r\n    if ($object->count < intval($config->content(\'max_attempts\'))) {\r\n        return $object->count;\r\n    } else {\r\n        return (-1);\r\n    }\r\n}\r\n\r\nfunction getConfig()\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n    $p = new Item();\r\n    $p = $p->getPageById(130);\r\n    return ($p);\r\n}\r\n\r\nfunction generateId()\r\n{\r\n    $c = uniqid(rand(), true);\r\n    $md5c = md5($c);\r\n\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"INSERT INTO tara_unique_id (unique_id)\r\n                VALUES (\'\" . $md5c . \"\')\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n\r\n        if ($stmt->execute()) {\r\n            $flag = $md5c;\r\n        } else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction sendEmail($nome, $email, $premio)\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/Mailer.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/EmailGetter.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/EmailGetter.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n\r\n    $config = getConfig();\r\n    $premio = $config->content(\'premio\' . $premio);\r\n\r\n    $mensagens = new Item();\r\n    $mensagens = $mensagens->getPageById(368);\r\n    $titulo = $mensagens->content(\'titulo\');\r\n    $texto1 = $mensagens->content(\'texto1\');\r\n    $texto2 = $mensagens->content(\'texto2\');\r\n\r\n    $headerImg = $config->getFirstImage(\'\', \'header_img\');\r\n    $footerImg = $config->getFirstImage(\'\', \'footer_img\');\r\n    echo(\"headerImg: \" . $headerImg);\r\n    echo(\"footerImg: \" . $footerImg);\r\n    $headerHtml = \'\';\r\n    $footerHtml = \'\';\r\n    if ($headerImg != URL_PUBLIC . \"public/images/tara_default\") {\r\n        $headerHtml = \'<img src=\"\' . $headerImg . \'\" width=\"400\" alt=\"header\" />\';\r\n    }\r\n    if ($footerImg != URL_PUBLIC . \"public/images/tara_default\") {\r\n        $footerHtml = \'<img src=\"\' . $footerImg . \'\" width=\"200\" alt=\"footer\" />\';\r\n    }\r\n    echo(\"headerHtml: \" . $headerHtml);\r\n    echo(\"footerHtml: \" . $footerHtml);\r\n\r\n    $body = \'<!DOCTYPE html>\r\n                <html>\r\n                    <head>\r\n                        <title></title>\r\n                        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n                    </head>\r\n                    <body style=\"background-color:#eee;padding:0;border:0;margin:0;\">\r\n                    <center>\r\n                        <table width=\"600px\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#eeeeee;padding:0;border:0;margin:0;\">\r\n                            <tr>\r\n                                <td style=\"background-color:#FFF;padding:20px\">\r\n                            <center>\r\n                            \' . $headerHtml . \'\r\n                                <br><br>\r\n                                <h3 style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $titulo . \'</h3>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $texto1 . \'</b></p>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\';\r\n                                $body .= $premio;\r\n                                $body .= \'</p>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $texto2 . \'</p>\r\n                                <br><br>\r\n                                \' . $footerHtml . \'\r\n                                <br />\r\n                            </center>\r\n                            </td>\r\n                            </tr>\r\n                        </table>\r\n                    </center>\r\n                </body>\r\n                </html>\';\r\n\r\n    $mailer = new Mailer(\"paulo@mail.com\", \"CONTINENTE - SLOT MACHINE\", $email, $titulo, $body);\r\n\r\n    return ($mailer->sendMail());\r\n}\r\n\r\nfunction updatePremio($id, $premio)\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"UPDATE tara_page_part SET content=\'\" . $premio . \"\', content_html=\'\" . $premio . \"\' WHERE name=\'premio\' AND page_id=\'\" . $id . \"\'\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        if ($stmt->execute())\r\n            $flag = 1;\r\n        else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction incrementPremio()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $hasPremio = getPremiosByDate();\r\n\r\n    if ($hasPremio != null)\r\n        $premio = $hasPremio->id;\r\n    else\r\n        $premio = insertPremios();\r\n\r\n    $sql = \"UPDATE tara_premios_diarios SET qtd=qtd+1, time=CURTIME() WHERE id=\'\" . $premio . \"\'\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        if ($stmt->execute())\r\n            $flag = 1;\r\n        else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction getPremiosByDate()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"SELECT *, CURTIME(), (CURTIME()-TIME(time)) AS last FROM tara_premios_diarios WHERE data= DATE(NOW())\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        $stmt->execute();\r\n\r\n        $object = $stmt->fetchObject();\r\n    }\r\n    return ($object);\r\n}\r\n\r\nfunction insertPremios()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"INSERT INTO tara_premios_diarios (data, qtd)\r\n                VALUES (NOW(), \'0\')\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n\r\n        if ($stmt->execute()) {\r\n            $id = $__tarambola_CONN__->lastInsertId();\r\n            $flag = $id;\r\n        } else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\n','<?\r\n\r\nif (isset($_GET[\'opt\'])) {\r\n    $__tarambola_CONN__ = new PDO(DB_DSN, DB_USER, DB_PASS);\r\n\r\n    if ($__tarambola_CONN__->getAttribute(PDO::ATTR_DRIVER_NAME) == \'mysql\')\r\n        $__tarambola_CONN__->setAttribute(PDO::MYSQL_ATTR_USE_BUFFERED_QUERY, true);\r\n\r\n    Record::connection($__tarambola_CONN__);\r\n    Record::getConnection()->exec(\"set names \'utf8\'\");\r\n\r\n    if ($_GET[\'opt\'] == \"win\") { //****************************************************** WIN SEND EMAIL\r\n        $user = getUser($_GET[\'id\']);\r\n        $nome = $user->content(\'nome\');\r\n        $email = $user->content(\'email\');\r\n        echo($nome . \' - \' . $email);\r\n        echo(updatePremio($_GET[\'id\'], $_GET[\'premio\']));\r\n        echo(sendEmail($nome, $email, $_GET[\'premio\']));\r\n        incrementPremio();\r\n    } else if ($_GET[\'opt\'] == \"loose\") { //************************************************ LOOSE\r\n    } else if ($_GET[\'opt\'] == \"getid\") { //************************************************ GET UNIQUE ID\r\n        require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n\r\n        $premios = getPremiosByDate();\r\n        if ($premios == null) {\r\n            insertPremios();\r\n            $premios = getPremiosByDate();\r\n        }\r\n        $config = getConfig();\r\n\r\n        $p = new Item();\r\n        $p = $p->getPageById(315);\r\n        echo(\'<?xml version=\"1.0\" encoding=\"UTF-8\"?>\' .\r\n            \'<data>\' .\r\n            \'<unique_id>\' . generateId() . \'</unique_id>\' .\r\n            \'<connect_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"connect_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"connect_2\") . \'</msg_2>\' .\r\n            \'<msg_3>\' . $p->content(\"connect_3\") . \'</msg_3>\' .\r\n            \'</connect_msg>\' .\r\n            \'<slot_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"slot_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"slot_2\") . \'</msg_2>\' .\r\n            \'</slot_msg>\' .\r\n            \'<loose_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"loose_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"loose_2\") . \'</msg_2>\' .\r\n            \'<msg_3>\' . $p->content(\"loose_3\") . \'</msg_3>\' .\r\n            \'<msg_4>\' . $p->content(\"loose_4\") . \'</msg_4>\' .\r\n            \'<msg_5>\' . $p->content(\"loose_5\") . \'</msg_5>\' .\r\n            \'</loose_msg>\' .\r\n            \'<win_msg>\' .\r\n            \'<msg_1>\' . $p->content(\"win_1\") . \'</msg_1>\' .\r\n            \'<msg_2>\' . $p->content(\"win_2\") . \'</msg_2>\' .\r\n            \'</win_msg>\' .\r\n            \'<prizes>\' .\r\n            \'<act_prizes>\' . $premios->qtd . \'</act_prizes>\' .\r\n            \'<max_prize>\' . $config->content(\'nr_premios\') . \'</max_prize>\' .\r\n            \'<last_prize>\' . $premios->last . \'</last_prize>\' .\r\n            \'</prizes>\' .\r\n            \'</data>\'\r\n        );\r\n    }\r\n} else {\r\n    $config = getConfig();\r\n    $user = getUser($_GET[\'id\']);\r\n    $attempts = getAttempts($user->content(\'email\'));\r\n    $attempts = intval($config->content(\'max_attempts\')) - $attempts;\r\n    $premios = getPremiosByDate();\r\n    if ($premios == null) {\r\n        insertPremios();\r\n        $premios = getPremiosByDate();\r\n    }\r\n    echo(\'<?xml version=\"1.0\" encoding=\"UTF-8\"?>\' .\r\n        \'<user>\' .\r\n        \'<id>\' . $user->id . \'</id>\' .\r\n        \'<nome>\' . $user->content(\'nome\') . \'</nome>\' .\r\n        \'<email>\' . $user->content(\'email\') . \'</email>\' .\r\n        \'<unique_id>\' . $user->content(\'unique_id\') . \'</unique_id>\' .\r\n        \'<attempts>\' . $attempts . \'</attempts>\' .\r\n        \'<maxAttempts>\' . $config->content(\'max_attempts\') . \'</maxAttempts>\' .\r\n        \'</user>\');\r\n}\r\n\r\n//*************************** FUNCTIONS *********************************//\r\nfunction getUser($id)\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n    $p = new Item();\r\n    $p = $p->getPageById($id);\r\n    return ($p);\r\n}\r\n\r\nfunction getAttempts($email)\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"SELECT DISTINCT count(p.id) AS count From tara_page_part AS p INNER JOIN tara_page_part AS p2 ON p2.page_id=p.page_id WHERE p.name=\'data\' AND DAY(NOW())=DAY(p.content) AND MONTH(NOW())=MONTH(p.content) AND YEAR(NOW())=YEAR(p.content) AND p2.name=\'email\' AND p2.content=\'\" . $email . \"\'\";\r\n    $arr = array();\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        $stmt->execute();\r\n        $object = $stmt->fetchObject();\r\n    }\r\n    $config = getConfig();\r\n    if ($object->count < intval($config->content(\'max_attempts\'))) {\r\n        return $object->count;\r\n    } else {\r\n        return (-1);\r\n    }\r\n}\r\n\r\nfunction getConfig()\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n    $p = new Item();\r\n    $p = $p->getPageById(130);\r\n    return ($p);\r\n}\r\n\r\nfunction generateId()\r\n{\r\n    $c = uniqid(rand(), true);\r\n    $md5c = md5($c);\r\n\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"INSERT INTO tara_unique_id (unique_id)\r\n                VALUES (\'\" . $md5c . \"\')\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n\r\n        if ($stmt->execute()) {\r\n            $flag = $md5c;\r\n        } else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction sendEmail($nome, $email, $premio)\r\n{\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/Mailer.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/EmailGetter.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/mail/EmailGetter.php\';\r\n    require_once SERVER_URL . \'tarambola/app/classes/Item.php\';\r\n\r\n    $config = getConfig();\r\n    $premio = $config->content(\'premio\' . $premio);\r\n\r\n    $mensagens = new Item();\r\n    $mensagens = $mensagens->getPageById(368);\r\n    $titulo = $mensagens->content(\'titulo\');\r\n    $texto1 = $mensagens->content(\'texto1\');\r\n    $texto2 = $mensagens->content(\'texto2\');\r\n\r\n    $headerImg = $config->getFirstImage(\'\', \'header_img\');\r\n    $footerImg = $config->getFirstImage(\'\', \'footer_img\');\r\n    echo(\"headerImg: \" . $headerImg);\r\n    echo(\"footerImg: \" . $footerImg);\r\n    $headerHtml = \'\';\r\n    $footerHtml = \'\';\r\n    if ($headerImg != URL_PUBLIC . \"public/images/tara_default\") {\r\n        $headerHtml = \'<img src=\"\' . $headerImg . \'\" width=\"400\" alt=\"header\" />\';\r\n    }\r\n    if ($footerImg != URL_PUBLIC . \"public/images/tara_default\") {\r\n        $footerHtml = \'<img src=\"\' . $footerImg . \'\" width=\"200\" alt=\"footer\" />\';\r\n    }\r\n    echo(\"headerHtml: \" . $headerHtml);\r\n    echo(\"footerHtml: \" . $footerHtml);\r\n\r\n    $body = \'<!DOCTYPE html>\r\n                <html>\r\n                    <head>\r\n                        <title></title>\r\n                        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n                    </head>\r\n                    <body style=\"background-color:#eee;padding:0;border:0;margin:0;\">\r\n                    <center>\r\n                        <table width=\"600px\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#eeeeee;padding:0;border:0;margin:0;\">\r\n                            <tr>\r\n                                <td style=\"background-color:#FFF;padding:20px\">\r\n                            <center>\r\n                            \' . $headerHtml . \'\r\n                                <br><br>\r\n                                <h3 style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $titulo . \'</h3>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $texto1 . \'</b></p>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\';\r\n                                $body .= $premio;\r\n                                $body .= \'</p>\r\n                                <p style=\"font-family:\\\'arial\\\', sans-sarif;color:#444\">\' . $texto2 . \'</p>\r\n                                <br><br>\r\n                                \' . $footerHtml . \'\r\n                                <br />\r\n                            </center>\r\n                            </td>\r\n                            </tr>\r\n                        </table>\r\n                    </center>\r\n                </body>\r\n                </html>\';\r\n\r\n    $mailer = new Mailer(\"paulo@mail.com\", \"CONTINENTE - SLOT MACHINE\", $email, $titulo, $body);\r\n\r\n    return ($mailer->sendMail());\r\n}\r\n\r\nfunction updatePremio($id, $premio)\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"UPDATE tara_page_part SET content=\'\" . $premio . \"\', content_html=\'\" . $premio . \"\' WHERE name=\'premio\' AND page_id=\'\" . $id . \"\'\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        if ($stmt->execute())\r\n            $flag = 1;\r\n        else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction incrementPremio()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $hasPremio = getPremiosByDate();\r\n\r\n    if ($hasPremio != null)\r\n        $premio = $hasPremio->id;\r\n    else\r\n        $premio = insertPremios();\r\n\r\n    $sql = \"UPDATE tara_premios_diarios SET qtd=qtd+1, time=CURTIME() WHERE id=\'\" . $premio . \"\'\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        if ($stmt->execute())\r\n            $flag = 1;\r\n        else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\nfunction getPremiosByDate()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"SELECT *, CURTIME(), (CURTIME()-TIME(time)) AS last FROM tara_premios_diarios WHERE data= DATE(NOW())\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n        $stmt->execute();\r\n\r\n        $object = $stmt->fetchObject();\r\n    }\r\n    return ($object);\r\n}\r\n\r\nfunction insertPremios()\r\n{\r\n    global $__tarambola_CONN__;\r\n\r\n    $sql = \"INSERT INTO tara_premios_diarios (data, qtd)\r\n                VALUES (NOW(), \'0\')\";\r\n\r\n    if ($stmt = $__tarambola_CONN__->prepare($sql)) {\r\n\r\n        if ($stmt->execute()) {\r\n            $id = $__tarambola_CONN__->lastInsertId();\r\n            $flag = $id;\r\n        } else\r\n            $flag = 0;\r\n    }\r\n    return ($flag);\r\n}\r\n\r\n','2014-05-19 15:47:51','2020-02-09 23:48:44',1,1,NULL),(15,'register','','<!-- ****************** CONTENT **************** -->\r\n<?php $reg = PAGE::find(\'mensagens/mensagens-mobile\'); ?>\r\n<article class=\"content-container\">\r\n    <img src=\"<? echo($reg->getFirstImage(\'\', \'image\')); ?>\" id=\"slotmachine\" alt=\"\" />\r\n    <div class=\"clear2\"></div>\r\n    <!-- ************** FORM **************** -->\r\n    <div id=\"formContainer\">\r\n        <form id=\"registform\">\r\n            <input type=\"hidden\" class=\"input\" id=\"unique_id\" value=\"<? echo($_GET[\'id\']); ?>\">\r\n            <section class=\"form-side\">\r\n                <label for=\"name\">\r\n                    <?php $reg->pContent(\'formlabel1\'); ?>\r\n                </label>\r\n                <input type=\"text\" class=\"input\" id=\"nameInput\" value=\"\">\r\n                <div class=\"clear20 hide1280\"></div>\r\n            </section>\r\n            <div class=\"clear4\"></div>\r\n            <section class=\"form-side\">\r\n                <label for=\"email\">\r\n                    <?php $reg->pContent(\'formlabel2\'); ?>\r\n                </label>\r\n                <div class=\"clear0\"></div>\r\n                <input type=\"email\" class=\"input\" id=\"emailInput\" value=\"\">\r\n            </section>\r\n            <div class=\"clear3\"></div>\r\n            <button type=\"submit\" class=\"classname\" id=\"submit\"><center><h4><?php $reg->pContent(\'formbutton\'); ?></h4></center></button>\r\n            <input id=\"validationMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'validationwarning\'); ?>\"></input>\r\n            <input id=\"tentativasMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'esgotadaswarning\'); ?>\"></input>\r\n            <input id=\"aguardaMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'waitwarning\'); ?>\"></input>\r\n        </form>\r\n    </div>\r\n</article>','<!-- ****************** CONTENT **************** -->\r\n<?php $reg = PAGE::find(\'mensagens/mensagens-mobile\'); ?>\r\n<article class=\"content-container\">\r\n    <img src=\"<? echo($reg->getFirstImage(\'\', \'image\')); ?>\" id=\"slotmachine\" alt=\"\" />\r\n    <div class=\"clear2\"></div>\r\n    <!-- ************** FORM **************** -->\r\n    <div id=\"formContainer\">\r\n        <form id=\"registform\">\r\n            <input type=\"hidden\" class=\"input\" id=\"unique_id\" value=\"<? echo($_GET[\'id\']); ?>\">\r\n            <section class=\"form-side\">\r\n                <label for=\"name\">\r\n                    <?php $reg->pContent(\'formlabel1\'); ?>\r\n                </label>\r\n                <input type=\"text\" class=\"input\" id=\"nameInput\" value=\"\">\r\n                <div class=\"clear20 hide1280\"></div>\r\n            </section>\r\n            <div class=\"clear4\"></div>\r\n            <section class=\"form-side\">\r\n                <label for=\"email\">\r\n                    <?php $reg->pContent(\'formlabel2\'); ?>\r\n                </label>\r\n                <div class=\"clear0\"></div>\r\n                <input type=\"email\" class=\"input\" id=\"emailInput\" value=\"\">\r\n            </section>\r\n            <div class=\"clear3\"></div>\r\n            <button type=\"submit\" class=\"classname\" id=\"submit\"><center><h4><?php $reg->pContent(\'formbutton\'); ?></h4></center></button>\r\n            <input id=\"validationMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'validationwarning\'); ?>\"></input>\r\n            <input id=\"tentativasMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'esgotadaswarning\'); ?>\"></input>\r\n            <input id=\"aguardaMsg\" type=\"hidden\" value=\"<?php $reg->pContent(\'waitwarning\'); ?>\"></input>\r\n        </form>\r\n    </div>\r\n</article>','2014-05-21 15:21:18','2020-02-10 22:10:56',1,1,NULL),(16,'tryagain','','<!-- ****************** CONTENT **************** -->\r\n<article class=\"content-container\">\r\n    <?php $wait = PAGE::find(\'mensagens/mensagens-mobile\'); ?>\r\n    <img src=\"<? echo($wait->getFirstImage(\'\', \'image\')); ?>\" id=\"slotmachine\" alt=\"\" />\r\n    <div class=\"clear2\"></div>\r\n    <div class=\"messages-style\">\r\n        <h4><?php $wait->pContent(\'wait\'); ?></h4>\r\n        <h5><?php $wait->pContent(\'wait2\'); ?></h5>\r\n    </div>\r\n\r\n</article>\r\n\r\n','<!-- ****************** CONTENT **************** -->\r\n<article class=\"content-container\">\r\n    <?php $wait = PAGE::find(\'mensagens/mensagens-mobile\'); ?>\r\n    <img src=\"<? echo($wait->getFirstImage(\'\', \'image\')); ?>\" id=\"slotmachine\" alt=\"\" />\r\n    <div class=\"clear2\"></div>\r\n    <div class=\"messages-style\">\r\n        <h4><?php $wait->pContent(\'wait\'); ?></h4>\r\n        <h5><?php $wait->pContent(\'wait2\'); ?></h5>\r\n    </div>\r\n\r\n</article>\r\n\r\n','2014-05-21 15:21:31','2020-02-10 22:08:55',1,1,NULL);
/*!40000 ALTER TABLE `tara_snippet` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2020-07-04 12:38:40
